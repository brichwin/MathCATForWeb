# WebAssembly/JavaScript Interface for MathCAT

MathCAT is a library that supports conversion of MathML to speech and braille among other things.

This project is a rough stab at adding a WebAssembly/JavaScript interface to MathCAT.
Visit [the MathCAT project page](https://nsoiffer.github.io/MathCAT/) for more info or if you want to play around with MathCAT's capabilities, [try out the demo](https://nsoiffer.github.io/MathCATDemo/).

## To build this project:
- In a folder, download or git clone MathCAT
- In the same folder, download or git clone MathCATForWeb
- Your folder structure should look like this:
  ```
  ParentFolder/
  ├── MathCAT/
  ├── MathCATForWeb/
  ```
- Install 'wasm-pack' (if not already installed):
  ```sh
  cargo install wasm-pack
  ```
- Build the project:
  ```sh
  wasm-pack build --target web --release
  ```
  - If it builds successfully, you should get a message like: "Your wasm pkg is ready to publish at .../MathCATForWeb/pkg."

## Files in the `pkg` folder.
When you build your project using wasm-pack, the pkg folder contains several files. Here is a description of each file:
 - mathcat_web_bg.wasm: The WebAssembly binary. This is the core file that contains the compiled WebAssembly code.
 - mathcat_web.js: This JavaScript file provides the bindings to interact with the WebAssembly module. It typically includes functions to initialize the WebAssembly instance and to call its exports.
 - mathcat_web_bg.js: This is a JavaScript glue code file that handles the low-level interaction between the WebAssembly binary and JavaScript.
 - mathcat_web.d.ts: TypeScript declaration file, useful if you are using TypeScript.
 - package.json: This file is used for npm to manage dependencies and is not typically needed if you are just serving the files from a web server without using npm.
 - README.md: Documentation file generated by wasm-pack. Not needed for deployment.
### Essential Files for Web Server Deployment
For deploying your WebAssembly module to a web server, you only need a subset of the files in the `pkg` folder. 
 - mathcat_web_bg.wasm: The WebAssembly binary.
 - mathcat_web.js: The JavaScript file that initializes and interacts with the WebAssembly module.
 - mathcat_web_bg.js: The JavaScript glue code file.

## Example Deployment Structure
Here's an example deployment structure:
```
/your_deployment_directory
├── index.html
└── mathCATForWeb
    ├── mathcat_web.js
    ├── mathcat_web_bg.js
    └── mathcat_web_bg.wasm
```
### Example `index.html`
In the following example, note:
 - The path to the `mathcat_web.js` file must be correct in the import statement.
 - You must call `wasm_set_rules_dir('Rules')` before calling any of the other MathCAT functions (other than `wasm_get_version`).
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathCAT Web</title>
</head>
<body>
    <script type="module">
        import init, { wasm_set_rules_dir, wasm_get_version, wasm_set_preference, wasm_set_mathml, wasm_get_spoken_text, wasm_get_braille } from './mathCATForWeb/mathcat_web.js';

        async function run() {
            await init();

            console.log('MathCAT Version:', wasm_get_version());

            try {
                await wasm_set_rules_dir('Rules');
                console.log('Rules directory set');

                try {
                    await wasm_set_preference('SpeechStyle', 'ClearSpeak');
                    console.log('SpeechStyle Preference set');
                } catch (error) {
                    console.error('Error setting SpeechStyle preference:', error);
                }

                try {
                    const canonicalMathML = await wasm_set_mathml(`<math><mrow><mi>x</mi><mo>=</mo><msup><mi>y</mi><mn>2</mn></msup></mrow></math>`);
                    console.log('Canonical MathML:', canonicalMathML);
                    const spokenText = await wasm_get_spoken_text();
                    console.log('Spoken Text:', spokenText);
                } catch (error) {
                    console.error('Error processing MathML:', error);
                }

                try {
                    const braille = await wasm_get_braille('');
                    console.log('Braille:', braille);
                } catch (error) {
                    console.error('Error getting braille:', error);
                }

            } catch (error) {
                console.error('Error setting rules directory:', error);
                console.error('Cannot continue, rules directory must be set before calling other MathCAT functions.')
            }
        }

        run();
    </script>
  </body>
</html>
```
Which should produce the following console output:
```
[Log] MathCAT Version: – "0.6.4" (index.html, line 15)
[Log] Rules directory set (index.html, line 19)
[Log] SpeechStyle Preference set (index.html, line 23)
[Log] Canonical MathML: – " <math id='Ms9sz8xr-0' data-id-added='true'>↵  <mrow id='Ms9sz8xr-1' data-id-added='true'>…" (index.html, line 30)
[Log] Spoken Text: – "x is equal to y squared" (index.html, line 32)
[Log] Braille: – "⠭⠀⠨⠅⠀⠽⠘⠆" (index.html, line 39)
```
