<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathCAT Web</title>
</head>
<body>
    <script type="module">
        import init, { wasm_set_rules_dir, wasm_get_version, wasm_set_preference, wasm_set_mathml, wasm_get_spoken_text, wasm_get_braille } from './pkg/mathcat_web.js';

        async function run() {
            await init();

            console.log('MathCAT Version:', wasm_get_version());

            try {
                await wasm_set_rules_dir('Rules');
                console.log('Rules directory set');

                try {
                    await wasm_set_preference('SpeechStyle', 'ClearSpeak');
                    console.log('SpeechStyle Preference set');
                } catch (error) {
                    console.error('Error setting SpeechStyle preference:', error);
                }

                try {
                    const canonicalMathML = await wasm_set_mathml(`<math><mrow><mi>x</mi><mo>=</mo><msup><mi>y</mi><mn>2</mn></msup></mrow></math>`);
                    console.log('Canonical MathML:', canonicalMathML);
                    const spokenText = await wasm_get_spoken_text();
                    console.log('Spoken Text:', spokenText);
                } catch (error) {
                    console.error('Error processing MathML:', error);
                }

                try {
                    const braille = await wasm_get_braille('');
                    console.log('Braille:', braille);
                } catch (error) {
                    console.error('Error getting braille:', error);
                }

            } catch (error) {
                console.error('Error setting rules directory:', error);
                console.error('Cannot continue, rules directory must be set before calling other MathCAT functions.')
            }
        }

        run();
    </script>
</body>
</html>
