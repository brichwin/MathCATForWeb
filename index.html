<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathCAT Web</title>
</head>
<body>
    <script type="module">
        import init, { MathCAT as mathCAT } from './pkg/mathcat_web.js'
        window.mathCAT = mathCAT
        async function run() {
            await init()

            console.log('MathCAT Version:', mathCAT.getVersion())

            try {
                function setPreferences(preferences) {
                    console.log(`\nSetting Preferences`)
                    for (const [name, value] of Object.entries(preferences)) {
                        try {
                            mathCAT.setPreference(name, value)
                            console.log(`  Preference ${name} set to ${value}`)
                        } catch (err) {
                            throw new Error(`> Error setting MathCAT preference ${name} to ${value}: ${err}`)
                        }
                    }
                }

                function getPreferences(preferences) {
                    console.log(`\nChecking Preferences`)
                    Object.keys(preferences).forEach(name => {
                        try {
                            const currentValue = mathCAT.getPreference(name)
                            console.log(`  Preference ${name} is ${currentValue}`)
                        } catch (err) {
                            throw new Error(`> Error reading MathCAT preference ${name}: ${err}`)
                        }
                    })
                }

                const preferences = {
                    Language: 'en',
                    SpeechStyle: 'ClearSpeak',
                    Verbosity: 'Verbose'
                }

                const sampleMathML = `<math><mrow><mfrac><mi>x</mi><mi>y</mi></mfrac><mo>+</mo><mn>2</mn></mrow></math>`

                mathCAT.setRulesDir('Rules')
                console.log(`Rules directory set`)

                setPreferences(preferences)
                getPreferences(preferences)

                console.log(`\nSetting MathML`)
                const canonicalMathML = mathCAT.setMathML(sampleMathML)
                console.log(`Canonical MathML: ${canonicalMathML}`)

                getPreferences(preferences)

                const spokenText = mathCAT.getSpokenText()
                console.log(`\nSpoken Text: ${spokenText}`)

                getPreferences(preferences)

                const braille = mathCAT.getBraille('')
                console.log(`\nBraille: ${braille}`)

                getPreferences(preferences)

            } catch (error) {
                console.error(`Error using MathCAT: ${error}`)
            }
        }

        run()
    </script>
</body>
</html>